@if (weightTrackerConfig$ | async; as weightTrackerConfig) {
  <canvasjs-chart
    [options]="data()"
    (chartInstance)="handleChartReady($event)"
  />

  <div class="dashboard">
    <ng-container>
      <div>
        @if (!todayIsRecorded()) {
          <form [formGroup]="form" (submit)="updateWeights()">
            <label>
              Enter Weight<br />
              <input
                type="number"
                placeholder="195.2"
                formControlName="y"
                step=".1"
              />
            </label>
            <button>Save</button>
          </form>
          <div>{{ form.get("x")?.value | date }}</div>
        } @else {
          <button (click)="todayIsRecorded.set(false)">Edit weight</button>
        }
      </div>
      <div class="sep"></div>
    </ng-container>

    @if (configForm$ | async; as config) {
      <!-- <pre>{{ config | json }}</pre> -->
      <form [formGroup]="configForm">
        <label>
          Projection Precision (last {{ config.windowSize }} weigh-ins)<br />
          <input
            type="range"
            formControlName="windowSize"
            min="2"
            [max]="data().data[0].dataPoints.length"
          />
        </label>
      </form>
      <div class="sep"></div>
    }

    @if (this.data().data[0].dataPoints.length > 1) {
      <diff [data]="this.data().data[0].dataPoints" />
      <div class="sep"></div>
    }

    <stats
      [data]="data().data[0].dataPoints"
      [canvasJSChart]="canvasJSChart || {}"
    />
    <div class="sep"></div>

    <!-- WIP -->
    <!-- @if (byWeekday$ | async) {
      <form [formGroup]="byWeekday">
        <label
          >By Weekday<br />
          <select formControlName="weekday">
            @for (opt of weekdays; track $index) {
              <option [value]="opt.value">{{ opt.label }}</option>
            }
          </select>
        </label>
      </form>
    } -->

    <div class="config">
      <dialog #config>
        <header>
          <h2>⚙ Settings</h2>
          <span class="close" (click)="hideDialog(config)">×</span>
        </header>
        @if (config.open) {
          <config-form (saved)="hideDialog(config)">
            <button type="button" (click)="hideDialog(config)">Cancel</button>
          </config-form>
        }
      </dialog>
      <!-- <a class="test">⚙</a> -->
      <a class="click" (click)="showDialog(config)">⚙</a>
    </div>
  </div>
  <!-- <pre>{{ projected() | json }}</pre> -->
}
